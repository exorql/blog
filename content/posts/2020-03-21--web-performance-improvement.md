---
title: "サイトパフォーマンスを改善するためにできること"
date: "2020-03-21T22:12:03.284Z"
template: "post"
draft: false
slug: "web-performance-improvement"
category: "SEO"
tags:
  - "SEO"
  - "Performance"
  - "SiteSpeed"
description: "ウェブパフォーマンスを良くする最大の目的はユーザーがある目的のために費やす時間やリソースをできる限り少なくすることで、その分ユーザーの時間を豊にできることだと思います。そのためウェブページの初期ロード時のパフォーマンスだけでなくウェブページ内でのインタラクションの描画のパフォーマンスも重要といえるでしょう。"
---

SEOに関わるエンジニア・デザイナーにお勧めしたい
[現場のプロから学ぶ SEO技術バイブル(特典PDF付き)](https://amzn.to/3dn4PhA) という本の中の「サイトの高速化について」読んだものをメモとして残しておく。

本書はSEOとはから始まり、施策の効果検証、内部施策と外部施策、構造化マークアップやサイトの高速化など現場のエンジニアやデザイナー向けに、踏み込んだ実装方法などが解説されていてとても良書だと思う。
SEO嫌いなエンジニアや仕事で機会が出来た方にぜひお勧めしたい本です。

## Webパフォーマンスを上げる目的
ウェブパフォーマンスを良くする最大の目的はユーザーがある目的のために費やす時間やリソースをできる限り少なくすることで、その分ユーザーの時間を豊にできることだと思います。そのためウェブページの初期ロード時のパフォーマンスだけでなくウェブページ内でのインタラクションの描画のパフォーマンスも重要といえるでしょう。

## レンダリング処理の高速化（CSS）
CSSで対応すべき点は以下の3つ
1. CSSの解析スピードを上げる
	+ CSSセレクタは右から左へ解析される
	+ 具体的かつ少数なセレクタで指定すると処理が早い
1. ファースビューで利用しないCSSをレンダリング前に読み込ませない
1. CSSファイルをWebブラウザに早期に読み込ませる
	+ 基本的にはhead要素の先頭に記述

## レンダリング処理の高速化（JavaScript）
JavaScriptで対応すべき点は以下2つ
1. HTMLのbody要素の最後に記述する
	+ head要素にあるとJavaScriptの解析・実行が完了するまで、body要素が読み込まれない
	+ Googleアナリティクスタグなど確実に読み込ませたいものはhead要素に記述（body要素の最後だとスクリプトが実行される前にユーザーが別ページに遷移してしまう場合があるため）
1. 非同期に読み込ませる
	+ JavaScriptは基本的には非同期で読み込ませ、HTMLの解析を停止させないことが重要
		+ \<script>タグにasync属性ないしdefer属性を付与する 

## レンダリング処理の高速化（画像ファイル）
画像ファイルのダウンロード前にHTMLやCSSで画像サイズを指定することが重要。width/heightの指定が必須

## ネットワーク処理の高速化
ここでは、通信量・通信回数・通信距離に分けて考えます。
### 通信量
テキストファイル（HTML/CSS/JavaScript）の圧縮
1. Minify圧縮
	+ 不要な改行やスペース、コメントなどを削除する（コメントやスペース、改行などはコンピュータにとっては変わらず、全てサイズがある）
	+ gulpなどのTask Runnerで自動化する
1. gzip圧縮
	+ 圧縮アルゴリズムでファイル内容を書き換える
	+ 圧縮プログラムgzipによって作られるエンコーディングフォーマット（拡張子は.gz）
	+ Minify圧縮を施した上でgzip圧縮をかけるが、gzipによる削減率は60〜90%と効果が大きい
		+ 実装方法
		Apacheでmod_deflateを設定することで、テキストファイルをブラウザに返却する際に自動的にgzip圧縮してから送信する。一方、CSSやJavaScriptなどの静的ファイルはあらかじめgzip圧縮しておく方がベター

### 通信回数
1. HTTP/2
	+ GoogleのSPDY（スピーディ）と呼ばれる通信プロトコルをベースに開発された規格
	+ 1つのTCPコネクション内で複数の仮想的な通信路（ストリーム）を開設
	+ このストリームの多重化により1回の接続で並行して複数データのリクエスト/レスポンスの処理が可能になり、データロード時間を短縮できる
2. bundle処理（ファイルを一つにまとめる）
	+ Minify圧縮・gzip圧縮
	+ gulpなどのタスクランナー
	+ 画像のbundle処理→利用する画像を1ファイルにまとめる
	+ そのスプライト画像からCSSで各画像を抽出して表示させるCSSスプライト
	+ HTMLファイルにインライン化する（Base64エンコードなど）
	+ 画像を遅延読み込みする（jqueryプラグインのjquery_lazyloadなどがある）

### 通信距離
CDNの利用。

## サーバー処理の高速化
サーバー処理に置ける高速化のポイントは以下の4つ。
1. 処理を分離する
	+ サーバーが担う一連の処理を複数のサーバーに分担させることで、処理量超過による遅延を防ぐ（例：画像サーバー、Webサーバー、DBサーバー）
1. 処理マシンの台数を増やす（またはスペックを上げる）
	+ 1つの処理を1台ではなく、複数台のサーバーに分散
1. プログラム処理を高速化する
	+ テーブル設計の変更（テーブル分割やインデックス最適化）
	+ DB操作するSQLの最適化
1. ミドルウェアのパラメータを修正する