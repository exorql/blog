---
title: "レンダリングパイプラインについて"
date: "2020-11-03T22:40:32.169Z"
template: "post"
draft: false
slug: "openframeworks-rendering-pipeline"
category: "openFrameworks"
tags:
  - "メディアアート"
  - "クリエイティブ・コーディング"
  - "3D"
description: "openFrameworksは3Dグラフィックスの描画のためのライブラリとしてOpenGLというプログラミングのインターフェイスを使用しています。OpenGLは2次元の図形だけでなく、3次元のグラフィクスを簡単に扱うことが可能です。
OpenGLで使用するGLSL（OpenGL Shading Language）というシェーディングプログラム言語を使うことでGPUを直接操作することができ、美しいグラフィックスを高速に描くことが可能になります。"
---

openFrameworksは3Dグラフィックスの描画のためのライブラリとしてOpenGLというプログラミングのインターフェイスを使用しています。OpenGLは2次元の図形だけでなく、3次元のグラフィクスを簡単に扱うことが可能です。<br>
OpenGLで使用するGLSL（OpenGL Shading Language）というシェーディングプログラム言語を使うことでGPUを直接操作することができ、美しいグラフィックスを高速に描くことが可能になります。<br>
そのGLSLをちゃんと記述するためには、OpenGLのレンダリングプロセスを理解する必要があるので、今回はレンダリングパイプラインについてまとめてみました。

## レンダリングパイプラインとは
レンダリングパイプラインとは、OpenGLがGPU上で実行する処理プロセスのこと。<br>
レンダリングとは入力データである、3Dモデルのポリゴンデータや、テクスチャデータを使用して画面や画像として出力することです。

## 処理プロセス
1フレームをレンダリングするために以下の処理を随時実行しています。<br>
シェーダには開発側がソースを書いて作成するプログラマブルシェーダと既存でシェーダ機能が用意されている固定機能シェーダがあります。<br>
**GLSL（OpenGL Shading Language）の機能によって、2、3、5をプログラマブルに実装することができます。**

1. 入力、空間内の物体の座標、頂点決定
1. 座標変換、陰影処理、テクスチャ座標指定 — [ バーテックスシェーダ ]
1. 頂点シェーダから送られてきたポリゴンを面に分割 (テッセレーション) — [ ジオメトリシェーダ ]
1. ポリゴンをレンダリングしピクセル情報へと変換 (ラスタライズ)
1. ピクセル単位の陰影処理、ピクセルの色決定 — [ フラグメントシェーダ ]
1. ブレンディング、隠面消去、深度テスト
1. 画面全体を描画情報として保持 (フレームバッファの保持)

## バーテックスシェーダ（Vertex Shader）とは
3Dの頂点に関する処理をするシェーダ<br>
OpenGLでは3D空間の頂点情報 (x, y, z)をGPUに渡して処理をしますが、実際に描画するディスプレイは2Dなので、渡した頂点情報が最終的にディスプレイのどこに位置することになるのかを計算してあげる必要があります。<br>
その計算をしてくれるのがバーテックスシェーダで、座標変換、陰影処理、テクスチャ座標指定など、頂点に関する情報の全てをシェーダに渡すことが可能です。頂点の位置情報（座標）だけは必須です。

## ジオメトリシェーダ（Geometry Shader）とは
ジオメトリシェーダはプリミティブ(メッシュを構成する基本形状)の増減や変換ができるシェーダー<br>
メッシュの頂点数をいじれたり、頂点を増やしてポリゴンにしたり、増やした頂点の位置や回転などを制御することができるため、エフェクトの幅をかなり広げることができます。

## ラスタライズ（Rasterize）とは
ラスタライズ（ラスタ化処理）とは、頂点シェーダで決まった座標とポリゴン単位の色を元にしてディスプレイ上にピクセル単位で描画情報を設定する処理です。<br>
ラスタライザが行う処理は「線形の補間」と「頂点カラーの補間」です。

## フラグメントシェーダ（Fragment Shader）とは
Fragment(ピクセル)に色を付けるシェーダ<br>
フラグメントシェーダはラスタライザで設定された色情報を取得してそこに何らかの対応を行い、その結果の色情報をGPUへ戻します。<br>
画面上のピクセルそれぞれに対して最終的に出力される色を決めるためことができます。

## openFrameworksでGLSLを使う
openFrameworksでGLSLを扱うのに、ofShaderクラスを使用します。<br>
https://openframeworks.cc/ja//documentation/gl/ofShader/
